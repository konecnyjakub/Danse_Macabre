#textdomain wesnoth-Danse_Macabre
[scenario]
    id=14_night_of_the_living_dead
    next_scenario=15_dawn_of_the_dead

    name=_ "Night of the living dead"
    map_data="{~add-ons/Danse_Macabre/maps/14_night_of_the_living_dead.map}"
    {DEFAULT_SCHEDULE}

    {SCENARIO_MUSIC 4_The_Forging_of_Souls.ogg}
    {EXTRA_SCENARIO_MUSIC 11_The_Barbarian_Host.ogg}
    {EXTRA_SCENARIO_MUSIC battle.ogg}

    [side]
        side=1
        controller=human
        team_name=macabre
        user_team_name=_"Macabre"
        type=Death Lord
        id=Macabre
        name=_ "Macabre"
        unrenamable=yes
        canrecruit=yes
        recruit=Walking Corpse,Ghoul,Skeleton,Skeleton Archer,DM Skeleton Rider,Zombie Mage
        fog=no
        shroud=yes
        gold=900
        village_gold=1
        {FLAG_VARIANT undead}
    [/side]

    [side]
        side=2
        controller=ai
        team_name=lich
        user_team_name=_"Lich"
        type=newMal Oryzias
        id=Mal Oryzias
        name=_ "Mal Oryzias"
        canrecruit=yes
        recruit=Spectre,Nightgaunt,Dark Cavalier,Chocoknight,Draug,Banebow,Deathbringer,L Ghast
        gold=0
        village_gold=0
        income=-2
        fog=no
        shroud=no
        [ai]
            aggression=0.9
            recruitment_pattern=fighter,archer,scout
            village_value=0
            leader_aggression=0.8
        [/ai]
    [/side]

#ifdef EASY
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "L Ghast" 2}
#endif
#ifdef NORMAL
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "L Ghast" 3}
#endif
#ifdef HARD
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "L Ghast" 4}
#endif

    [side]
        side=3
        controller=ai
        team_name=lich
        user_team_name=_"Lich"
        type=Lich
        id=leader3
        canrecruit=yes
        max_moves=0
        recruit=Shadow,Dark Cavalier,Chocoknight,Dread Bat
        gold=0
        village_gold=0
        income=-2
        fog=no
        shroud=no
    [/side]

    [side]
        side=4
        controller=ai
        team_name=lich
        user_team_name=_"Lich"
        type=Lich
        id=leader4
        canrecruit=yes
        max_moves=0
        recruit=Draug,Banebow,Necromancer,Wraith
        gold=0
        village_gold=0
        income=-2
        fog=no
        shroud=no
        [ai]
            recruitment_pattern=fighter,fighter,archer,archer,mixed fighter,scout,scout
        [/ai]
    [/side]

    [side]
        side=5
        controller=ai
        team_name=lich
        user_team_name=_"Lich"
        type=Lich
        id=leader5
        canrecruit=yes
        max_moves=0
        recruit=Draug,Spectre,Banebow,Deathbringer,Necromancer
        gold=0
        village_gold=0
        income=4
        fog=no
        shroud=no
        [ai]
            recruitment_pattern=fighter,fighter,archer,archer,scout,mixed fighter
        [/ai]
    [/side]

    [side]
        side=6
        controller=ai
        team_name=lich
        user_team_name=_"Lich"
        type=Necromancer
        id=leader6
        canrecruit=yes
        max_moves=0
        recruit=Draug,Dark Sorcerer,Dark Cavalier
        gold=0
        village_gold=0
        income=-2
        fog=no
        shroud=no
        [ai]
            recruitment_pattern=fighter,fighter,scout,scout,scout,mixed fighter,mixed fighter
        [/ai]
    [/side]

    [side]
        side=7
        controller=ai
        team_name=lich
        user_team_name=_"Lich"
        type=Necromancer
        gender=female
        id=leader7
        canrecruit=yes
        max_moves=0
        recruit=Draug,Banebow,Wraith
        gold=0
        village_gold=0
        income=-2
        fog=no
        shroud=no
        [ai]
            recruitment_pattern=fighter,archer,scout
        [/ai]
    [/side]

    [side]
        side=8
        controller=ai
        team_name=lich
        user_team_name=_"Lich"
        type=Necromancer
        id=leader8
        canrecruit=yes
        max_moves=0
        recruit=Revenant,Bone Shooter,Wraith,Bone Dragoon,Dark Adept,Dark Sorcerer
        {GOLD 400 420 440}
        {INCOME 10 15 15}
        village_gold=3
        fog=no
        shroud=no
    [/side]

    [side]
        side=9
        controller=ai
        team_name=lich
        user_team_name=_"Lich"
        type=Necromancer
        gender=female
        id=leader9
        canrecruit=yes
        max_moves=0
        recruit=Revenant,Bone Shooter,Wraith,Bone Dragoon,Dark Adept,Dark Sorcerer
        {GOLD 400 420 440}
        {INCOME 10 15 15}
        village_gold=3
        fog=no
        shroud=no
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 8,9 "Wraith" 1}
#ifdef EASY
    {LIMIT_CONTEMPORANEOUS_RECRUITS 8,9 "Dark Sorcerer" 1}
#else
    {LIMIT_CONTEMPORANEOUS_RECRUITS 8,9 "Dark Sorcerer" 2}
#endif

    {STARTING_VILLAGES_AREA 2 50 2 7}
    {STARTING_VILLAGES_AREA 3 50 32 5}
    {STARTING_VILLAGES_AREA 3 50 15 7}
    {STARTING_VILLAGES_AREA 4 27 4 4}
    {STARTING_VILLAGES_AREA 4 38 5 3}
    {STARTING_VILLAGES_AREA 5 36 13 4}
    {STARTING_VILLAGES_AREA 6 17 4 4}
    {STARTING_VILLAGES_AREA 6 25 18 4}
    {STARTING_VILLAGES_AREA 7 36 31 4}
    {STARTING_VILLAGES_AREA 7 36 22 5}
    {STARTING_VILLAGES_AREA 7 21 28 1}

    [event]
        name=prestart

        {KILL_NO_EXPERIENCE}

        [objectives]
            side=1
            [objective]
                condition=win
                description=_ "Survive in anyway possible"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Macabre"
            [/objective]
        [/objectives]

        {PLACE_IMAGE items/bonestack.png 33 40}
        {PLACE_IMAGE items/bonestack.png 8 25}
        {PLACE_IMAGE scenery/rock-cairn.png 37 13}

        {GENERIC_UNIT_DM 2 Banebow (gateman) 13 37}
        [+unit]
            max_moves=0
            [modifications]
                [object]
                    id=gateman_power
                    silent=yes
                    [effect]
                        apply_to=new_ability
                        [abilities]
                            {ABILITY_REGENERATES_20}
                            {ABILITY_DARKEN}
                        [/abilities]
                    [/effect]
                    [effect]
                        apply_to=resistance
                        replace=yes
                        [resistance]
                            arcane=0
                            blade=0
                            cold=0
                            fire=0
                            impact=0
                            pierce=0
                        [/resistance]
                    [/effect]
                    [effect]
                        apply_to=halo
                        halo=halodm/dark-aura.png
                    [/effect]
                [/object]
            [/modifications]
        [/unit]
        # wmllint:  whofield clear GENERIC_UNIT_DM

        # wmllint: recognize Boreas
        # wmllint: recognize Pech
        # wmllint: recognize gingly
        [store_unit]
            [filter]
                id=Boreas
            [/filter]
            variable=stored_Boreas
            kill=yes
        [/store_unit]
        [store_unit]
            [filter]
                id=Pech
            [/filter]
            variable=stored_Pech
            kill=yes
        [/store_unit]
        [store_unit]
            [filter]
                id=gingly
            [/filter]
            variable=stored_gingly
            kill=yes
        [/store_unit]
        [store_unit]
            [filter]
                side=1
                [not]
                    id=Macabre
                [/not]
            [/filter]
            variable=stored_recalllist
            kill=yes
        [/store_unit]

        [remove_shroud]
            side=1
            terrain=Re,Rd,Ww,Gs^Fdw,Hh^Vhh,Hh^Fdw,Ww^Bw/,Ww^Vm,Ke,Ce,Ce^Kov,Wwf
            [or]
                x=0-7,8-57,14
                y=0-45,40-45,36
            [/or]
        [/remove_shroud]
        [remove_shroud]
            side=1
            terrain=Xos
            [and]
                x=11-14,15,15-39,40-41,42-57,56
                y=0-37,16-19,35-38,36,33-36,32
            [/and]
        [/remove_shroud]

        {HIDDEN_GUARDIAN 2 "Deathblade" 31 30}
        {HIDDEN_GUARDIAN 2 "Deathblade" 27 28}
        {HIDDEN_GUARDIAN 2 "Deathblade" 29 27}
        {HIDDEN_GUARDIAN 2 "Deathblade" 28 13}
        {HIDDEN_GUARDIAN 2 "DM Chocobone" 23 21}
        {HIDDEN_GUARDIAN 2 "Revenant" 25 21}
        {HIDDEN_GUARDIAN 2 "Bone Shooter" 22 20}

        {HIDDEN_GUARDIAN 2 "Revenant" 31 28}
        {HIDDEN_GUARDIAN 2 "Revenant" 22 26}
        {HIDDEN_GUARDIAN 2 "Revenant" 34 22}
        {HIDDEN_GUARDIAN 2 "Revenant" 34 20}

        {HIDDEN_GUARDIAN 2 "DM Chocobone" 20 29}
        {HIDDEN_GUARDIAN 2 "DM Chocobone" 29 23}
        {HIDDEN_GUARDIAN 2 "DM Chocobone" 39 27}
        {HIDDEN_GUARDIAN 2 "DM Chocobone" 29 16}
        {HIDDEN_GUARDIAN 2 "Bone Shooter" 38 17}

        {HIDDEN_GUARDIAN 2 "Bone Shooter" 24 30}
        {HIDDEN_GUARDIAN 2 "Bone Shooter" 24 23}
        {HIDDEN_GUARDIAN 2 "Bone Shooter" 34 25}
        {HIDDEN_GUARDIAN 2 "Chocoknight" 36 9}
        {HIDDEN_GUARDIAN 2 "Chocoknight" 42 12}

        {HIDDEN_GUARDIAN 2 "Deathbringer" 23 8}
        {HIDDEN_GUARDIAN 2 "Draug" 30 6}
        {HIDDEN_GUARDIAN 2 "Banebow" 25 10}
        {HIDDEN_GUARDIAN 2 "Chocoknight" 38 3}
        {HIDDEN_GUARDIAN 2 "Draug" 33 7}
        {HIDDEN_GUARDIAN 2 "Deathbringer" 33 1}
        {HIDDEN_GUARDIAN 2 "Draug" 36 2}

        {HIDDEN_GUARDIAN 2 "Draug" 55 18}
        {HIDDEN_GUARDIAN 2 "Banebow" 56 18}
        {HIDDEN_GUARDIAN 2 "Deathbringer" 56 17}
        {HIDDEN_GUARDIAN 2 "Chocoknight" 54 10}
        {HIDDEN_GUARDIAN 2 "Chocoknight" 56 11}
        {HIDDEN_GUARDIAN 2 "Chocoknight" 55 11}

        {HIDDEN_GUARDIAN 2 "Lich" 48 2}
        {HIDDEN_GUARDIAN 2 "Lich" 50 1}
        {HIDDEN_GUARDIAN 2 "Lich" 53 6}
        {HIDDEN_GUARDIAN 2 "Lich" 55 5}

        {GAURDIAN_DM 5 (Skeletal Dragon) 35 13}
        {GAURDIAN_DM 5 (Skeletal Dragon) 38 14}
        {GAURDIAN_DM 4 (Skeletal Dragon) 26 4}
        {GAURDIAN_DM 4 (Skeletal Dragon) 28 4}
        {GAURDIAN_DM 3 (Skeletal Dragon) 48 31}
        {GAURDIAN_DM 3 (Skeletal Dragon) 49 33}
        {GAURDIAN_DM 2 (Skeletal Dragon) 49 4}
        {GAURDIAN_DM 2 (Skeletal Dragon) 51 5}

        {GENERIC_UNIT 5 "Draug" 36 13}
        {GENERIC_UNIT 5 "Draug" 37 14}
        {GENERIC_UNIT 5 "Banebow" 37 12}
        {GENERIC_UNIT 5 "Banebow" 38 12}

        {MODIFY_UNIT side=1 facing ne}
        {MODIFY_UNIT (
            [not]
                side=1
            [/not]
        ) facing sw}

        {VARIABLE advice no}
        {VARIABLE firstkeep no}
        {VARIABLE secondkeep no}
        {VARIABLE keep 0}
        {VARIABLE lichnight no}
        {VARIABLE firstln no}
        {VARIABLE leaders 0}
        {VARIABLE liches 0}
        {VARIABLE dying no}
    [/event]

    [event]
        name=start
        [music]
            name=7_Before_the_Battle.ogg
            append=yes
            immediate=yes
        [/music]
        [message]
            speaker=Mal Oryzias
            message= _ "Ahh...so you have abandoned your fellows, haven't you?"
        [/message]
        [message]
            speaker=Macabre
            message= _ "Say what you want! I'm fed up with chasing. We're going to settle this here and now!"
        [/message]
        [message]
            speaker=Mal Oryzias
            message= _ "Bah. What can you do without your main forces? I, however, have scraped together many souls of the dead and gained strength like never before. You can't even touch me, and you will perish here!"
        [/message]
        [scroll_to]
            x,y=33,40
        [/scroll_to]
        [delay]
            time=300
        [/delay]
        [scroll_to]
            x,y=8,25
        [/scroll_to]
        [delay]
            time=300
        [/delay]
        [scroll_to]
            x,y=6,40
        [/scroll_to]

        [message]
            speaker=Macabre
            message= _ "(One gatekeeper and two mobile forces... If this goes on, I will be attacked from both sides. It's better to defeat the gatekeeper quickly and take up my position inside the castle...)"
        [/message]
        [delay]
            time=500
        [/delay]
        [sound]
            name=tail.ogg
        [/sound]
        {NOSCROLL_MOVEUNIT id=Macabre 12 37}
        [animate_unit]
            flag=attack
            [filter]
                x,y=12,37
            [/filter]
            [primary_attack]
                name=axe
            [/primary_attack]
            hits=yes
            [facing]
                x,y=13,37
            [/facing]
            [animate]
                [filter]
                    x,y=13,37
                [/filter]
                flag=defend
                text=1 # wmllint: ignore
                red=255
                with_bars=yes
            [/animate]
        [/animate_unit]

        {MODIFY_UNIT id=gateman hitpoints 49}
        [redraw][/redraw]

        [animate_unit]
            flag=attack
            [filter]
                x,y=12,37
            [/filter]
            [primary_attack]
                name=axe
            [/primary_attack]
            hits=yes
            [facing]
                x,y=13,37
            [/facing]
            [animate]
                [filter]
                    x,y=13,37
                [/filter]
                flag=defend
                text=1 # wmllint: ignore
                red=255
                with_bars=yes
            [/animate]
        [/animate_unit]

        {MODIFY_UNIT id=gateman hitpoints 48}
        [redraw][/redraw]

        {NOSCROLL_MOVEUNIT id=Macabre 10 38}
        [redraw][/redraw]
        {MODIFY_UNIT id=Macabre facing ne}
        [redraw][/redraw]

        [message]
            speaker=Macabre
            message= _ "Damn! What is this crap?"
        [/message]
        [message]
            speaker=Mal Oryzias
            message= _ "What's wrong with you? Can't you defeat even a gatekeeper? Hehe."
        [/message]
        [message]
            speaker=Macabre
            message= _ "(There must be some tricks... OK, I'll defeat two other enemies. Though the task will be quite a challenge, I have no choice in this case.)"
        [/message]
        [delay]
            time=500
        [/delay]

        {NOSCROLL_MOVEUNIT id=Macabre 7 40}
        [redraw][/redraw]
        {MODIFY_UNIT id=Macabre facing ne}
        [redraw][/redraw]

        {MODIFY_TERRAIN Ce (6,7,7,8) (39-40,39,41,39-40)}
        {MODIFY_TERRAIN Ke (7) (40)}
        [redraw]
        [/redraw]
        [sound]
            name=mace.wav
        [/sound]
        [delay]
            time=600
        [/delay]
    [/event]

    [event]
        name=recruit
        first_time_only=no
        [filter]
            side=2
            type=Dark Cavalier
        [/filter]
        [object]
            silent=yes
            [effect]
                apply_to=new_ability
                [abilities]
                    {ABILITY_STEADFAST}
                    {ABILITY_REGENERATES}
                [/abilities]
            [/effect]
        [/object]
    [/event]

    [event]
        name=recruit
        first_time_only=no
        [filter]
            side=2
            type=Spectre,Nightgaunt
        [/filter]
        [object]
            silent=yes
            [effect]
                apply_to=new_ability
                [abilities]
                    {ABILITY_REGENERATES}
                [/abilities]
            [/effect]
            [effect]
                apply_to=movement
                increase=1
            [/effect]
        [/object]
    [/event]

    [event]
        name=recruit
        first_time_only=no
        [filter]
            side=2
            type=Draug
        [/filter]
        [object]
            silent=yes
            [effect]
                apply_to=new_ability
                [abilities]
                    {ABILITY_REGENERATES}
                [/abilities]
            [/effect]
            [effect]
                apply_to=hitpoints
                increase_total=5
                heal_full=yes
            [/effect]
        [/object]
    [/event]

    [event]
        name=recruit
        first_time_only=no
        [filter]
            side=2
            type=Banebow
        [/filter]
        [object]
            silent=yes
            [effect]
                apply_to=new_ability
                [abilities]
                    {ABILITY_REGENERATES}
                [/abilities]
            [/effect]
            [effect]
                apply_to=attack
                name=bow
                [set_specials]
                    mode=append
                    {WEAPON_SPECIAL_MARKSMAN}
                [/set_specials]
            [/effect]
        [/object]
    [/event]

    [event]
        name=recruit
        first_time_only=no
        [filter]
            side=2
            type=Deathbringer
        [/filter]
        [object]
            silent=yes
            [effect]
                apply_to=new_ability
                [abilities]
                    {ABILITY_REGENERATES}
                [/abilities]
            [/effect]
            [effect]
                apply_to=attack
                name=axe
                increase_damage=1
            [/effect]
        [/object]
    [/event]

    [event]
        name=recruit
        first_time_only=no
        [filter]
            side=2
            type=Chocoknight
        [/filter]
        [object]
            silent=yes
            [effect]
                apply_to=new_ability
                [abilities]
                    {ABILITY_REGENERATES}
                [/abilities]
            [/effect]
            [effect]
                apply_to=attack
                name=spear
                [set_specials]
                    mode=append
                    {WEAPON_SPECIAL_FIRSTSTRIKE}
                [/set_specials]
            [/effect]
        [/object]
    [/event]

    [event]
        name=turn 11
        [sound]
            name=bat-flapping.wav
        [/sound]
        [unstore_unit]
            variable=stored_Boreas
            find_vacant=yes
            x,y=3,41
        [/unstore_unit]
        [unstore_unit]
            variable=stored_Pech
            find_vacant=yes
            x,y=4,42
        [/unstore_unit]
        [unstore_unit]
            variable=stored_gingly
            find_vacant=yes
            x,y=2,42
        [/unstore_unit]
        [scroll_to]
            x,y=3,42
        [/scroll_to]
        {CLEAR_VARIABLE stored_Boreas}
        {CLEAR_VARIABLE stored_Pech}
        {CLEAR_VARIABLE stored_gingly}
        [music]
            name=6_East_Meets_West.ogg
            append=yes
            immediate=yes
        [/music]
        [message]
            speaker=Boreas
            message= _ "Boss!"
        [/message]
        [message]
            speaker=Macabre
            message= _ "Is that you, Boreas!?"
        [/message]
        [message]
            speaker=Boreas
            message= _ "Oh, thank heavens I made it in time! We annihilated the enemies."
        [/message]
        [message]
            speaker=Macabre
            message= _ "Good! What of the rest?"
        [/message]
        [message]
            speaker=Boreas
            message= _ "Everyone was all right. They should be here at dawn!"
        [/message]
        [message]
            speaker=Macabre
            message= _ "OK. Just a little more patience! Everyone, build up the defenses and survive!"
        [/message]
    [/event]

    [event]
        name=turn 13
        {FOREACH stored_recalllist recall_one}
            [unstore_unit]
                variable=stored_recalllist[$recall_one]
                x,y=recall,recall
            [/unstore_unit]
        {NEXT recall_one}
        {CLEAR_VARIABLE stored_recalllist}
        [music]
            name=northern_mountains2.ogg
            append=yes
            immediate=yes
        [/music]
        [recall]
            id=Merrin
            x,y=3,41
        [/recall]
        [recall]
            id=philosophy
            x,y=4,42
        [/recall]
        [recall]
            id=Neckfrill
            x,y=3,42
        [/recall]
        [recall]
            id=Spelk
            x,y=2,41
        [/recall]
        [recall]
            id=orlok
            x,y=3,43
        [/recall]
        [scroll_to]
            x,y=3,42
        [/scroll_to]
        [message]
            speaker=philosophy
            message= _ "Yoo-hoo!" # wmllint: no spellcheck
        [/message]
        [message]
            speaker=Merrin
            message= _ "Are you safe?"
        [/message]
        [message]
            speaker=Macabre
            message= _ "Philosophy! Merrin! The gamble has paid off...All that is left is to kill the lich."
        [/message]
        [message]
            speaker=philosophy
            message= _ "You can count on me!"
        [/message]
        [message]
            speaker=narrator
            message= _ "Now you can recall your units."
            image=wesnoth-icon.png
            duration=300
        [/message]

        [objectives]
            side=1
            [objective]
                condition=win
                description=_ "Kill the Ancient Lich"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Macabre"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Merrin"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Boreas"
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Philosophy"
            [/objective]
            note= _ "This is the last battle."
        [/objectives]
    [/event]

    [event]
        name=turn 14
        [message]
            speaker=philosophy
            message= _ "By the way, what is our immediate priority?"
        [/message]
        [message]
            speaker=Macabre
            message= _ "I can't eliminate that gatekeeper. He must be protected by some sort of power."
        [/message]
        [message]
            speaker=philosophy
            message= _ "Hmm... I suspect their keeps."
        [/message]
        [scroll_to]
            x,y=33,40
        [/scroll_to]
        [delay]
            time=300
        [/delay]
        [scroll_to]
            x,y=8,25
        [/scroll_to]
        [delay]
            time=300
        [/delay]
        [scroll_to]
            x,y=3,42
        [/scroll_to]
        [message]
            speaker=Merrin
            message= _ "Yes, shall we destroy them?"
        [/message]
        [message]
            speaker=Macabre
            message= _ "OK. Let's try it."
        [/message]
        [message]
            speaker=narrator
            message= _ "Put your units on the two keeps, and they will be destroyed."
            image=wesnoth-icon.png
            duration=300
        [/message]
        {VARIABLE advice yes}
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            x=33
            y=40
            side=1
        [/filter]
        [if]
            [variable]
                name=advice
                equals=yes
            [/variable]
            [and]
                [variable]
                    name=firstkeep
                    equals=no
                [/variable]
            [/and]
            [then]
                [sound]
                    name=skeleton-big-die.ogg
                [/sound]
                {REMOVE_IMAGE 33 40}
                {PLACE_IMAGE scenery/rubble.png 33 40}
                {MODIFY_TERRAIN Ce (8) (25)}
                [redraw][/redraw]
                {VARIABLE_OP keep add 1}
                [message]
                    speaker=narrator
                    message= _ "The keep has been destroyed."
                    image=wesnoth-icon.png
                    duration=300
                [/message]
                {VARIABLE firstkeep yes}
            [/then]
            [else]
                [allow_undo][/allow_undo]
            [/else]
        [/if]
        [if]
            [variable]
                name=keep
                equals=2
            [/variable]
            [then]
                [message]
                    speaker=Macabre
                    message= _ "Good. Let's see what happens..."
                [/message]
                [scroll_to]
                    x,y=13,37
                [/scroll_to]
                [delay]
                    time=500
                [/delay]
                [remove_object]
                    id=gateman
                    object_id=gateman_power
                [/remove_object]
                [redraw][/redraw]
                [sound]
                    name=slowed.wav
                [/sound]
                [message]
                    speaker=gateman
                    message= _ "......"
                [/message]
                [message]
                    speaker=Boreas
                    message= _ "That guy has lost his strength remarkably!"
                [/message]
                [message]
                    speaker=Macabre
                    message= _ "All right. Now we can remove him."
                [/message]
                {VARIABLE keep 0}
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            x=8
            y=25
            side=1
        [/filter]
        [if]
            [variable]
                name=advice
                equals=yes
            [/variable]
            [and]
                [variable]
                    name=secondkeep
                    equals=no
                [/variable]
            [/and]
            [then]
                [sound]
                    name=skeleton-big-die.ogg
                [/sound]
                {REMOVE_IMAGE 8 25}
                {PLACE_IMAGE scenery/rubble.png 8 25}
                {MODIFY_TERRAIN Ce (33) (40)}
                [redraw][/redraw]
                {VARIABLE_OP keep add 1}
                [message]
                    speaker=narrator
                    message= _ "The keep has been destroyed."
                    image=wesnoth-icon.png
                    duration=300
                [/message]
                {VARIABLE secondkeep yes}
            [/then]
            [else]
                [allow_undo][/allow_undo]
            [/else]
        [/if]
        [if]
            [variable]
                name=keep
                equals=2
            [/variable]
            [then]
                [message]
                    speaker=Macabre
                    message= _ "Good. Let's see what happens..."
                [/message]
                [scroll_to]
                    x,y=13,37
                [/scroll_to]
                [delay]
                    time=500
                [/delay]
                [remove_object]
                    id=gateman
                    object_id=gateman_power
                [/remove_object]
                [redraw][/redraw]
                [sound]
                    name=slowed.wav
                [/sound]
                [message]
                    speaker=gateman
                    message= _ "......"
                [/message]
                [message]
                    speaker=Boreas
                    message= _ "That guy has lost his strength remarkably!"
                [/message]
                [message]
                    speaker=Macabre
                    message= _ "All right. Now we can remove him."
                [/message]
                {VARIABLE keep 0}
            [/then]
        [/if]
    [/event]

    [event]
        name=die
        [filter]
            id=gateman
        [/filter]
        [kill]
            id=gateman
            animate=no
        [/kill]
        {DELAY 300}
        [message]
            speaker=Macabre
            message= _ "Good! Let's enter the Lich's nest!"
        [/message]
        {MODIFY_TERRAIN Ur (14) (36)}
        [remove_shroud]
            side=1
            x=12-22,23,23-39,23-24,25-26,27,28,29-30,31-32,33-34,35-36,37-38,39,40,40,41,41,42
            y=0-37,1-3,18-36,9-17,11-17,12-17,11-17,12-17,13-17,14-17,15-17,16-17,17,17-27,33-35,19-25,35,20-23
        [/remove_shroud]
        [redraw][/redraw]
        [message]
            speaker=Mal Oryzias
            message= _ "You are annoying as usual... OK, play with them, my servants."
        [/message]
        [message]
            speaker=leader6
            message= _ "As you wish."
        [/message]
        [message]
            speaker=leader7
            message= _ "Like you say."
        [/message]
        [modify_side]
            side=6
            {GOLD 500 550 600}
            {INCOME 15 20 25}
            village_gold=3
        [/modify_side]
        [modify_side]
            side=7
            {GOLD 500 550 600}
            {INCOME 15 20 25}
            village_gold=3
        [/modify_side]
    [/event]

    [event]
        name=moveto
        first_time_only=yes
        [filter]
            id=orlok
            [filter_location]
                terrain=Ql
            [/filter_location]
        [/filter]
        [message]
            speaker=orlok
            message= _ "Ugh...nasty lava. If I become sleepy here, I will end up dead."
        [/message]
    [/event]

    [event]
        name=new turn
        first_time_only=no
        [if]
            [have_unit]
                type=Vampire
                [filter_location]
                    terrain=Ql
                    time_of_day=lawful
                [/filter_location]
            [/have_unit]
            [then]
                [scroll_to_unit]
                    id=orlok
                [/scroll_to_unit]
                [message]
                    speaker=orlok
                    message= _ "I'm sleepy... No..."
                [/message]
                [kill]
                    type=Vampire
                    animate=yes
                [/kill]
                {DELAY 600}
            [/then]
        [/if]
    [/event]

    [event]
        name=new turn
        first_time_only=no
        {VARIABLE turn_temp $turn_number}
        [if]
            [variable]
                name=turn_temp
                greater_than_equal_to=30
            [/variable]
            [then]
                {VARIABLE_OP turn_temp modulo 12}
                [if]
                    [variable]
                        name=turn_temp
                        numerical_equals=6
                    [/variable]
                    [then]
                        [delay]
                            time=600
                        [/delay]
                        [sound]
                            name=magic-holy-1.ogg
                        [/sound]
                        {COLOR_ADJUST -40 -54 -14}
                        {COLOR_ADJUST -60 -80 -20}
                        {COLOR_ADJUST -20 -27 -7}
                        {COLOR_ADJUST 0 0 0}
                        [if]
                            [variable]
                                name=firstln
                                equals=no
                            [/variable]
                            [then]
                                [delay]
                                    time=600
                                [/delay]
                                [message]
                                    speaker=Boreas
                                    message= _ "Ugh! What is this pressure?"
                                [/message]
                                [message]
                                    speaker=Mal Oryzias
                                    message= _ "I stink of power...I'll share it with you."
                                [/message]
                                [message]
                                    speaker=Mal Oryzias
                                    message= _ "Come out, my pets!"
                                [/message]
                                {DELAY 600}
                                [sound]
                                    name=drake-hit-3.ogg
                                [/sound]
                                [unit]
                                    id=dragon1
                                    type=Fire Dragon
                                    side=2
                                    x,y=51,41
                                    random_traits=no
                                    upkeep=loyal
                                    facing=sw
                                [/unit]
                                [unit]
                                    id=dragon2
                                    type=Fire Dragon
                                    side=2
                                    x,y=4,9
                                    random_traits=no
                                    upkeep=loyal
                                    facing=se
                                [/unit]
                                {DELAY 600}
                                [message]
                                    speaker=philosophy
                                    message= _ "What was that noise!?"
                                [/message]
                                {DELAY 600}
                                [music]
                                    name=4_Desert_Chase.ogg
                                    append=yes
                                    immediate=yes
                                [/music]
                                [message]
                                    speaker=Boreas
                                    message= _ "Look! D, Dragons!"
                                [/message]
                                [scroll_to]
                                    x,y=51,41
                                [/scroll_to]
                                {DELAY 600}
                                [scroll_to]
                                    x,y=4,9
                                [/scroll_to]
                                {DELAY 600}
                                [message]
                                    speaker=Mal Oryzias
                                    message= _ "Hehe! Not only that. I think you'll enjoy it!"
                                [/message]
                                [message]
                                    speaker=Macabre
                                    message= _ "...OK, anything goes here. We'd better hurry up."
                                [/message]
                                {VARIABLE firstln yes}
                            [/then]
                            [else]
                                [message]
                                    speaker=Macabre
                                    message= _ "Again, be cautious of enemy reinforcements!"
                                [/message]
                            [/else]
                        [/if]
                    [/then]
                [/if]
            [/then]
        [/if]
        {CLEAR_VARIABLE turn_temp}
    [/event]

    [event]
        name=side 1 turn
        first_time_only=no
        {VARIABLE turn_temp $turn_number}

        [if]
            [variable]
                name=turn_temp
                greater_than_equal_to=30
            [/variable]
            [then]
                {VARIABLE_OP turn_temp modulo 12}
                [if]
                    [variable]
                        name=turn_temp
                        numerical_equals=6
                    [/variable]
                    [then]
                        {SCATTER_UNITS 3 (Deathbringer,Chocoknight) 0 (
                            terrain=Wo
                            x=34-38
                            y=41-43
                        ) (side=2
                        upkeep=loyal)}
                        {SCATTER_UNITS 3 (Deathbringer,Chocoknight) 0 (
                            terrain=Wo
                            x=3-7
                            y=21-23
                        ) (side=2
                        upkeep=loyal)}
                    [/then]
                [/if]
            [/then]
        [/if]
        {CLEAR_VARIABLE turn_temp}
    [/event]

    [event]
        name=die
        [filter]
            id=leader7
        [/filter]
        {VARIABLE_OP leaders add 1}
        [if]
            [variable]
                name=leaders
                numerical_equals=2
            [/variable]
            [then]
                {DELAY 1200}
                [message]
                    speaker=Mal Oryzias
                    message= _ "Damn! Useless necromancers... OK, hey, my fellow liches! Let's give those gate-crashers the glad hand!"
                [/message]
                [sound]
                    name=lich-hit-1.ogg
                [/sound]
                {DELAY 200}
                [sound]
                    name=lich-hit-2.ogg
                [/sound]
                {DELAY 200}
                [sound]
                    name=lich-hit-1.ogg
                [/sound]
                {DELAY 200}
                [sound]
                    name=lich-die.ogg
                [/sound]
                {DELAY 1000}
                [message]
                    speaker=Boreas
                    message= _ "Boss...I can't shake this bad feeling."
                [/message]
                [message]
                    speaker=Macabre
                    message= _ "Yes...but we are definitely tracking the lich to his lair."
                [/message]
                [message]
                    speaker=Mal Oryzias
                    message= _ "Open gate!"
                [/message]
                [scroll_to]
                    x,y=35,15
                [/scroll_to]
                [sound]
                    name=explosion.ogg
                [/sound]
                {MODIFY_TERRAIN Ur^Dr (32,33-34,35-36,37-38) (13,14,15,16)}
                [redraw][/redraw]
                {DELAY 600}
                [remove_shroud]
                    side=1
                    x=30-31,32-33,34-35,36,37-38,39-40,41-42,41,43-44,43,45-46,45
                    y=11-12,10-13,9-14,8-14,9-15,10-16,11-16,17,12-15,16,13-14,15
                [/remove_shroud]
                [redraw][/redraw]
                [modify_side]
                    side=5
                    {GOLD 550 600 650}
                    {INCOME 15 20 25}
                    village_gold=3
                [/modify_side]
                {VARIABLE leaders 0}
            [/then]
        [/if]
    [/event]

    [event]
        name=die
        [filter]
            id=leader6
        [/filter]
        {VARIABLE_OP leaders add 1}
        [if]
            [variable]
                name=leaders
                numerical_equals=2
            [/variable]
            [then]
                {DELAY 1200}
                [message]
                    speaker=Mal Oryzias
                    message= _ "Damn! Useless necromancers... OK, hey, my fellow liches! Let's give those gate-crashers the glad hand!"
                [/message]
                [sound]
                    name=lich-hit-1.ogg
                [/sound]
                {DELAY 200}
                [sound]
                    name=lich-hit-2.ogg
                [/sound]
                {DELAY 200}
                [sound]
                    name=lich-hit-1.ogg
                [/sound]
                {DELAY 200}
                [sound]
                    name=lich-die.ogg
                [/sound]
                {DELAY 1000}
                [message]
                    speaker=Boreas
                    message= _ "Boss...I can't shake this bad feeling."
                [/message]
                [message]
                    speaker=Macabre
                    message= _ "Yes...but we are definitely tracking the lich to his lair."
                [/message]
                [message]
                    speaker=Mal Oryzias
                    message= _ "Open gate!"
                [/message]
                [scroll_to]
                    x,y=35,15
                [/scroll_to]
                [sound]
                    name=explosion.ogg
                [/sound]
                {MODIFY_TERRAIN Ur^Dr (32,33-34,35-36,37-38) (13,14,15,16)}
                [redraw][/redraw]
                {DELAY 600}
                [remove_shroud]
                    side=1
                    x=30-31,32-33,34-35,36,37-38,39-40,41-42,41,43-44,43,45-46,45
                    y=11-12,10-13,9-14,8-14,9-15,10-16,11-16,17,12-15,16,13-14,15
                [/remove_shroud]
                [redraw][/redraw]
                [modify_side]
                    side=5
                    {GOLD 550 600 650}
                    {INCOME 15 20 25}
                    village_gold=3
                [/modify_side]
                {VARIABLE leaders 0}
            [/then]
        [/if]
    [/event]

    [event]
        name=die
        [filter]
            id=leader5
        [/filter]
        [kill]
            id=leader5
            animate=no
        [/kill]
        {DELAY 1200}
        [message]
            speaker=Mal Oryzias
            message= _ "Ay me! O, well, next!" # wmllint: no spellcheck
        [/message]
        {DELAY 600}
        [scroll_to]
            x,y=37,13
        [/scroll_to]
        [sound]
            name=explosion.ogg
        [/sound]
        {MODIFY_TERRAIN Ur^Dr (30-31,32-33,34,41,42-43,44-45) (11,10,9,17,16,15)}
        [redraw][/redraw]
        {DELAY 600}
        [remove_shroud]
            side=1
            [not]
                x=41,42,43,44,45,46,47-48,49-50,51-53,54-55,56-7
                y=4,3-4,3-5,2-5,2-6,0-6,0-7,0-8,0-9,0-8,0-7
            [/not]
        [/remove_shroud]
        [redraw][/redraw]
        [modify_side]
            side=4
            {GOLD 500 550 600}
            {INCOME 15 20 25}
            village_gold=3
        [/modify_side]
        [modify_side]
            side=3
            {GOLD 500 550 600}
            {INCOME 15 20 25}
            village_gold=3
        [/modify_side]
        {DELAY 600}
        [scroll_to]
            x,y=27,3
        [/scroll_to]
        {DELAY 600}
        [scroll_to]
            x,y=50,31
        [/scroll_to]
        {DELAY 600}
        [message]
            speaker=philosophy
            message= _ "Just great. This is a big sale in liches..."
        [/message]
        [message]
            speaker=Macabre
            message= _ "So true."
        [/message]
        [message]
            speaker=philosophy
            message= _ "By the way, the keep is also odd, isn't it?"
        [/message]

        [if]
            [have_unit]
                id=Macabre
                x=38-56
            [/have_unit]
            [then]
                {MODIFY_UNIT id=Macabre facing sw}
            [/then]
            [else]
                {MODIFY_UNIT id=Macabre facing se}
            [/else]
        [/if]
        [redraw][/redraw]
        [scroll_to]
            x,y=37,13
        [/scroll_to]
        {DELAY 600}
        [message]
            speaker=Macabre
            message= _ "Hmm... Yes, it looks more ominous. Let's try destroying it."
        [/message]
        [scroll_to]
            x,y=37,13
        [/scroll_to]
        {DELAY 600}
        [redraw][/redraw]
        [animate_unit]
            flag=attack
            [filter]
                x,y=$x2,$y2
            [/filter]
            [primary_attack]
                range=melee
            [/primary_attack]
            hits=yes
            [facing]
                x,y=37,13
            [/facing]
        [/animate_unit]
        [redraw][/redraw]
        [sound]
            name=gunshot.wav
        [/sound]
        {REMOVE_IMAGE 37 13}
        {PLACE_IMAGE scenery/rubble.png 37 13}
        {MODIFY_TERRAIN Chr (37) (13)}
        [redraw][/redraw]
        {DELAY 600}
        [redraw][/redraw]
        [sound]
            name=wail.wav
        [/sound]
        [move_unit_fake]
            type=Ghost
            x=37,38,39,40,41,42,43
            y=13,13,13,13,13,13,13
            side=2
        [/move_unit_fake]
        [sound]
            name=wail.wav
        [/sound]
        [move_unit_fake]
            type=Ghost
            x=37,36,35,34,33,32,31
            y=13,12,12,12,12,12,12
            side=2
        [/move_unit_fake]
        [sound]
            name=wail.wav
        [/sound]
        [move_unit_fake]
            type=Ghost
            x=37,38,39,39,40,40
            y=13,13,14,15,15,16
            side=2
        [/move_unit_fake]
        [sound]
            name=wail.wav
        [/sound]
        [move_unit_fake]
            type=Ghost
            x=37,37,36,37,36,36
            y=13,12,11,11,10,9
            side=2
        [/move_unit_fake]
        [redraw][/redraw]
        {DELAY 1000}
        [message]
            speaker=Merrin
            message= _ "...It would seem that it has been binding the souls of dead people."
        [/message]
        [message]
            speaker=Macabre
            message= _ "Yeah, he said he had scraped together many souls."
        [/message]
        [message]
            speaker=philosophy
            message= _ "Look. Another soul is coming."
        [/message]

        [music]
            name=silence
            immediate=yes
        [/music]
        [scroll_to]
            x,y=37,13
        [/scroll_to]
        {DELAY 600}
        [unit]
            side=2
            id=SpiritVita
            type=Princess
            variation=spirit
            name= _ "Vita"
            x,y=37,13
            random_traits=no
            animate=yes
            facing=sw
        [/unit]

        [if]
            [have_unit]
                id=Macabre
                x=38-56
            [/have_unit]
            [then]
                {MODIFY_UNIT id=SpiritVita facing se}
            [/then]
            [else]
                {MODIFY_UNIT id=SpiritVita facing sw}
            [/else]
        [/if]
        [redraw][/redraw]
        {DELAY 1000}
        [message]
            speaker=Macabre
            message= _ "......!"
        [/message]
        [music]
            name=wanderer.ogg
            immediate=yes
        [/music]
        [message]
            speaker=Macabre
            message= _ "Vi...Vita?"
        [/message]
        [message]
            speaker=SpiritVita
            message= _ "Yes...It's been a long time, Macabre."
        [/message]
        [message]
            speaker=Macabre
            message= _ "I...I can't believe it! Why?"
        [/message]
        [message]
            speaker=SpiritVita
            message= _ "At that time, you did indeed release my soul from my cursed body. But...I was eventually bound by that lich...like so many other pitiful souls. And as he gathered more souls, he grew more powerful, as you know."
        [/message]
        [message]
            speaker=SpiritVita
            message= _ "That's why he are trying to fill the world with death. He hungers for the souls...which is the source of his power."
        [/message]
        [message]
            speaker=Macabre
            message= _ "Hmmm...I see. But...I don't know what I should say now..."
        [/message]
        [message]
            speaker=SpiritVita
            message= _ "I know....Who could have imagined that we would meet again in this way..." # wmllint: no spellcheck
        [/message]
        [message]
            speaker=Macabre
            message= _ "I...I have already changed! I'm not what you knew... I'm a mere... cursed undead!"
        [/message]
        [message]
            speaker=SpiritVita
            message= _ "No! You still have your own mind! It means you are you."
        [/message]
        [message]
            speaker=Macabre
            message= _ "......"
        [/message]
        [message]
            speaker=SpiritVita
            message= _ "Also, you have released me again."
        [/message]
        [message]
            speaker=Macabre
            message= _ "...Could you go to heaven?"
        [/message]
        [message]
            speaker=SpiritVita
            message= _ "Yes, maybe."
        [/message]
        [message]
            speaker=Macabre
            message= _ "Hm..."
        [/message]
        [message]
            speaker=SpiritVita
            message= _ "Haha... Don't worry. I'm not going anywhere."
        [/message]
        [message]
            speaker=Macabre
            message= _ "...What do you mean?"
        [/message]
        [message]
            speaker=SpiritVita
            message= _ "I haven't just been bound. I learned how the lich binds the souls."
        [/message]
        [message]
            speaker=SpiritVita
            message= _ "So... I'm going to be your sword."
        [/message]
        [message]
            speaker=Macabre
            message= _ "What!?"
        [/message]
        [message]
            speaker=SpiritVita
            message= _ "I will possess your weapon. Then you can reave the lich's soul! Otherwise you couldn't annihilate him completely." # wmllint: no spellcheck
        [/message]
        [message]
            speaker=Macabre
            message= _ "But..."
        [/message]
        [music]
            name=silence
            immediate=yes
        [/music]
        [message]
            speaker=SpiritVita
            message= _ "Macabre...I love you."
        [/message]
        [message]
            speaker=Macabre
            message= _ "No! Wait!"
        [/message]
        [scroll_to]
            x,y=37,13
        [/scroll_to]
        [redraw][/redraw]
        [sound]
            name=magic-holy-miss-1.ogg
        [/sound]
        [animate_unit]
            flag=healing
            [filter]
                id=SpiritVita
            [/filter]
        [/animate_unit]
        [kill]
            id=SpiritVita
            animate=no
        [/kill]
        [move_unit_fake]
            type=Princess
            variation=spirit
            side=2
            x=37,37,37
            y=13,12,11
        [/move_unit_fake]
        [redraw][/redraw]
        {DELAY 600}
        [scroll_to_unit]
            id=Macabre
        [/scroll_to_unit]
        {DELAY 600}
        [redraw][/redraw]

        [store_unit]
            [filter]
                id=Macabre
            [/filter]
            variable=stored_Macabre
            kill=no
        [/store_unit]
        {VARIABLE fromy $stored_Macabre.y}
        {VARIABLE_OP fromy add -2}
        [move_unit_fake]
            type=Princess
            variation=spirit
            side=2
            x=$stored_Macabre.x,$stored_Macabre.x
            y=$fromy,$stored_Macabre.y
        [/move_unit_fake]
        {CLEAR_VARIABLE stored_Macabre}
        {CLEAR_VARIABLE fromy}
        [sound]
            name=magic-holy-miss-1.ogg
        [/sound]
        [animate_unit]
            flag=healing
            [filter]
                id=Macabre
            [/filter]
        [/animate_unit]
        [redraw][/redraw]
        {ADVANCE_UNIT id=Macabre (Death Ruler)}
        [object]
            [filter]
                id=Macabre
            [/filter]
            silent=yes
            [effect]
                apply_to=remove_attacks
                name=axe
            [/effect]
            [effect]
                apply_to=new_attack
                description= _ "soul reaver" # wmllint: no spellcheck
                name=soulreaver
                icon=attacks/soulreaver.png
                type=arcane
                range=melee
                damage=14
                number=5
                [specials]
                    {WEAPON_SPECIAL_SOULDRAIN}
                    {WEAPON_SPECIAL_MAGICAL}
                [/specials]
            [/effect]
        [/object]
        [redraw][/redraw]
        {DELAY 600}
        [message]
            speaker=Macabre
            message= _ "...Vita..."
        [/message]
        [message]
            speaker=Macabre
            message= _ "You were just released... and now you are bound again...to my bloody sword..."
        [/message]
        [message]
            speaker=Macabre
            message= _ "......"
        [/message]
        [message]
            speaker=Boreas
            message= _ "Boss..."
        [/message]
        [message]
            speaker=Macabre
            message= _ "No, don't say anything. After all, sentiment is unbecoming to the undead."
        [/message]
        [message]
            speaker=Macabre
            message= _ "All right. Come with me, Vita, and let's kill the lich!"
        [/message]
        [music]
            name=legends_of_the_north.ogg
            immediate=yes
            append=no
        [/music]
        [message]
            speaker=Macabre
            message= _ "Everyone! I'll take point! Follow me!"
        [/message]
        [message]
            speaker=philosophy
            message= _ "That's what I wanted to hear!"
        [/message]
        [message]
            speaker=Merrin
            message= _ "As you wish!"
        [/message]
        [message]
            speaker=Boreas
            message= _ "Let's do it!"
        [/message]
        [music]
            name=4_The_Forging_of_Souls.ogg
            append=yes
        [/music]
        [music]
            name=11_The_Barbarian_Host.ogg
            append=yes
        [/music]
        [music]
            name=battle.ogg
            append=yes
        [/music]
        [music]
            name=7_Before_the_Battle.ogg
            append=yes
        [/music]
        [music]
            name=6_East_Meets_West.ogg
            append=yes
        [/music]
        [music]
            name=northern_mountains2.ogg
            append=yes
        [/music]
        [music]
            name=4_Desert_Chase.ogg
            append=yes
        [/music]
        [music]
            name=6_East_Meets_West.ogg
            append=yes
        [/music]
    [/event]

    [event]
        name=die
        [filter]
            id=leader3
        [/filter]
        {VARIABLE_OP liches add 1}
        [if]
            [variable]
                name=liches
                numerical_equals=2
            [/variable]
            [then]
                {DELAY 1200}
                [message]
                    speaker=Macabre
                    message= _ "Hey! Your damned fellows have been finished. It's about time for you to appear!"
                [/message]
                [music]
                    name=silence.ogg
                    immediate=yes
                [/music]
                [scroll_to]
                    x,y=52,3
                [/scroll_to]
                [message]
                    speaker=Mal Oryzias
                    message= _ "You seem to want to trouble me at any cost...OK...I'll show you myself..."
                [/message]
                {DELAY 600}
                [sound]
                    name=explosion.ogg
                [/sound]
                {MODIFY_TERRAIN Ur^Dr (43-44,45-46,47) (6,7,8)}
                [redraw][/redraw]
                {DELAY 600}
                [remove_shroud]
                    side=1
                    x=41,42,43,44,45,46,47-48,49-50,51-53,54-55,56-7
                    y=4,3-4,3-5,2-5,2-6,0-6,0-7,0-8,0-9,0-8,0-7
                [/remove_shroud]
                [redraw][/redraw]
                [message]
                    speaker=Mal Oryzias
                    message= _ "WITH YOUR DEATH!!"
                    sound=lich-die.ogg
                [/message]
                [music]
                    name=ambuscade2.ogg
                    append=no
                    immediate=yes
                [/music]
                [modify_side]
                    side=2
                    {GOLD 650 700 750}
                    {INCOME 20 25 30}
                    village_gold=1
                [/modify_side]
                {VARIABLE liches 0}
                [music]
                    name=legends_of_the_north.ogg
                    append=yes
                [/music]
                [music]
                    name=4_The_Forging_of_Souls.ogg
                    append=yes
                [/music]
                [music]
                    name=11_The_Barbarian_Host.ogg
                    append=yes
                [/music]
                [music]
                    name=battle.ogg
                    append=yes
                [/music]
                [music]
                    name=7_Before_the_Battle.ogg
                    append=yes
                [/music]
                [music]
                    name=6_East_Meets_West.ogg
                    append=yes
                [/music]
                [music]
                    name=northern_mountains2.ogg
                    append=yes
                [/music]
                [music]
                    name=4_Desert_Chase.ogg
                    append=yes
                [/music]
                [music]
                    name=6_East_Meets_West.ogg
                    append=yes
                [/music]
            [/then]
        [/if]
    [/event]

    [event]
        name=die
        [filter]
            id=leader4
        [/filter]
        {VARIABLE_OP liches add 1}
        [if]
            [variable]
                name=liches
                numerical_equals=2
            [/variable]
            [then]
                {DELAY 1200}
                [message]
                    speaker=Macabre
                    message= _ "Hey! Your damned fellows have been finished. It's about time for you to appear!"
                [/message]
                [music]
                    name=silence.ogg
                    immediate=yes
                [/music]
                [scroll_to]
                    x,y=52,3
                [/scroll_to]
                [message]
                    speaker=Mal Oryzias
                    message= _ "You seems to want to trouble me at any cost... OK... I'll show you myself..."
                [/message]
                {DELAY 600}
                [sound]
                    name=explosion.ogg
                [/sound]
                {MODIFY_TERRAIN Ur^Dr (43-44,45-46,47) (6,7,8)}
                [redraw][/redraw]
                {DELAY 600}
                [remove_shroud]
                    side=1
                    x=41,42,43,44,45,46,47-48,49-50,51-53,54-55,56-7
                    y=4,3-4,3-5,2-5,2-6,0-6,0-7,0-8,0-9,0-8,0-7
                [/remove_shroud]
                [redraw][/redraw]
                [message]
                    speaker=Mal Oryzias
                    message= _ "WITH YOUR DEATH!!"
                    sound=lich-die.ogg
                [/message]
                [music]
                    name=ambuscade2.ogg
                    append=no
                    immediate=yes
                [/music]
                [modify_side]
                    side=2
                    {GOLD 650 700 750}
                    {INCOME 20 25 30}
                    village_gold=1
                [/modify_side]
                {VARIABLE liches 0}

                [music]
                    name=legends_of_the_north.ogg
                    append=yes
                [/music]
                [music]
                    name=4_The_Forging_of_Souls.ogg
                    append=yes
                [/music]
                [music]
                    name=11_The_Barbarian_Host.ogg
                    append=yes
                [/music]
                [music]
                    name=battle.ogg
                    append=yes
                [/music]
                [music]
                    name=7_Before_the_Battle.ogg
                    append=yes
                [/music]
                [music]
                    name=6_East_Meets_West.ogg
                    append=yes
                [/music]
                [music]
                    name=northern_mountains2.ogg
                    append=yes
                [/music]
                [music]
                    name=4_Desert_Chase.ogg
                    append=yes
                [/music]
                [music]
                    name=6_East_Meets_West.ogg
                    append=yes
                [/music]
            [/then]
        [/if]
    [/event]

    [event]
        name=last breath
        first_time_only=no
        [filter]
            id=Mal Oryzias
        [/filter]
        [if]
            [have_unit]
                id=Macabre
                x,y=$x2,$y2
            [/have_unit]
            [then]
                [music]
                    name=silence.ogg
                    immediate=yes
                [/music]
                [message]
                    speaker=Mal Oryzias
                    message= _ "Well...done..."
                [/message]
                [message]
                    speaker=Macabre
                    message= _ "You now meet your doom....Accept it gracefully, your highness." # wmllint: no spellcheck
                [/message]
                [message]
                    speaker=Mal Oryzias
                    message= _ "Ha...ha...hahahahahahahahaha!!!"
                [/message]
                [message]
                    speaker=Macabre
                    message= _ "!?"
                [/message]
                [message]
                    speaker=Mal Oryzias
                    message= _ "OK...I perish...But...You are NOT a winner...Both of us are LOSERS!"
                [/message]
                [message]
                    speaker=Macabre
                    message= _ "...Don't talk nonsense."
                [/message]
                [message]
                    speaker=Mal Oryzias
                    message= _ "You will soon know what I mean....Muhahahahahaha...." # wmllint: no spellcheck
                [/message]
                [kill]
                    id=Mal Oryzias
                    animate=yes
                [/kill]
                [delay]
                    time=1200
                [/delay]
                [message]
                    speaker=Macabre
                    message= _ "That..does...it." # wmllint: no spellcheck
                [/message]
                [delay]
                    time=1000
                [/delay]
                [endlevel]
                    result=victory
                    bonus=no
                    carryover_percentage=0
                    carryover_report=no
                    linger_mode=no
                [/endlevel]
            [/then]

            [else]
                [if]
                    [variable]
                        name=dying
                        equals=yes
                    [/variable]
                    [then]
                        [redraw][/redraw]
                        {VARIABLE unit.hitpoints 0}
                        [unstore_unit]
                            variable=unit
                        [/unstore_unit]
                        [heal_unit]
                            [filter]
                                id=Mal Oryzias
                            [/filter]
                            animate=yes
                            amount=1
                        [/heal_unit]
                    [/then]

                    [else]
                        {VARIABLE unit.hitpoints 0}
                        [unstore_unit]
                            variable=unit
                        [/unstore_unit]
                        [redraw][/redraw]
                        [message]
                            speaker=unit
                            message= _ "Ugh!!"
                        [/message]
                        [message]
                            speaker=unit
                            message= _ "But...you...haven't won yet!!"
                        [/message]
                        [redraw][/redraw]
                        [heal_unit]
                            [filter]
                                id=Mal Oryzias
                            [/filter]
                            animate=yes
                            amount=1
                        [/heal_unit]
                        [message]
                            speaker=unit
                            message= _ "Huff..huff...hehe... As long as there are souls in this world... I'll never perish!!" # wmllint: no spellcheck
                        [/message]
                        [message]
                            speaker=Macabre
                            message= _ "It's like Vita said... OK, retreat. I'll finish him."
                        [/message]
                        {VARIABLE dying yes}
                    [/else]
                [/if]
            [/else]
        [/if]
    [/event]

    {ABILITIES_EVENTS}

    {MACABRE_DEATH}
    {MERRIN_DEATH}
    {BOREAS_DEATH}
    {PHILOSOPHY_DEATH}
[/scenario]
